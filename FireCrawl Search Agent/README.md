# FireCrawl Search Agent

A small n8n workflow that converts chat instructions into Firecrawl `/search` queries via an agent, calls the Firecrawl API, and returns structured results.

## Purpose
- Turn a natural-language search request into a Firecrawl query (with operators like `site:`, `inurl:`, `-` exclusion, `intitle:`), call the `/v1/search` endpoint, and surface full result objects.

## Key Nodes
- **When chat message received** — chat trigger (webhook).
- **GPT 4.1 mini** — language model (OpenRouter) used as the LM for the agent.
- **Search Agent** — LangChain-style agent node containing the system prompt and tool wiring that builds the Firecrawl query and `limit` parameter.
- **Firecrawl Search** — `httpRequestTool` node that calls `https://api.firecrawl.dev/v1/search` using the constructed JSON body.
- **Site / In URL / Exclusion / Pro** — example `httpRequest` nodes with sample queries (kept for reference / quick testing).
- **Sticky Notes** — documentation and parameter hints embedded in the workflow.

## Agent System Prompt (summary)
The agent is configured as a "Firecrawl Search Query Generator Agent". It:
- Converts user instructions into a proper Firecrawl query string using supported operators
- Defaults `limit` to `5` if unspecified
- Always calls the Firecrawl Search tool with `query` and `limit`
- Returns all important fields from each `data` object in the tool response

Full prompt lives inside the `Search Agent` node in the workflow.

## Credentials & Setup
- Create an HTTP Header Auth credential in n8n for Firecrawl API and attach it to the `Firecrawl Search` node.
  - Name example: `Firecrawl`
  - Header: `Authorization: Bearer <YOUR_FIRECRAWL_API_KEY>` (or follow Firecrawl docs)
- Configure OpenRouter (or your chosen LM) credential for the `GPT 4.1 mini` node.
- Ensure the chat trigger webhook is reachable by your client (if public testing, use a tunnel or public URL).

Environment variables (recommended):
- `FIRECRAWL_API_KEY` — your key (store in n8n credential or environment as appropriate)
- `OPENROUTER_API_KEY` — for the OpenRouter LM credential

## Usage Examples
- Chat input: "Search the internet for Nate Herk"  
  Agent action: constructs query `Nate Herk`, calls `/v1/search` with `limit: 5`.
- Chat input: "Find pages with AI agent in the title from YouTube, show me 10"  
  Agent action: constructs `intitle:AI agent site:youtube.com`, calls `/v1/search` with `limit: 10`.

Example tool body generated by the agent:
```json
{
  "query": "intitle:AI agent site:youtube.com",
  "limit": 10,
  "scrapeOptions": { "formats": ["markdown","screenshot@fullPage"] }
}
```

## Testing
1. Open n8n and import/enable the workflow.
2. Configure `Firecrawl` and `OpenRouter` credentials.
3. Trigger the chat webhook (or `Execute Workflow`) with a sample message payload to simulate a chat input.
4. Inspect output from the `Firecrawl Search` node — each `data` object should be returned and mapped by the agent.

## Troubleshooting
- 401/403 from Firecrawl: verify API key and header format.
- Empty results: try a broader query or remove restrictive operators. Check `limit` value.
- Timeouts: increase request timeout or lower `limit` / `scrapeOptions` complexity.

## Notes & Recommendations
- Default `limit` is 5 inside the agent prompt. Tune for your use case.
- Replace any temporary public hosting (if used downstream) with S3/R2 in production for reliability.
- The workflow includes several example `httpRequest` nodes (Site / In URL / Exclusion / Pro) you can run manually for quick debugging.

---
Workflow file: Firecrawl_Search.json
